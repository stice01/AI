#Simon Tice Assginment 4
from functools import lru_cache
from itertools import accumulate

class Solution(object):
    def stoneGameII(self, piles):
        n = len(piles)

        # compute the total remaining stones in the piles from i so it can be referenced later
        remainingSum = [0] * (n + 1)
        for i in range(n - 1, -1, -1):
            remainingSum[i] = remainingSum[i + 1] + piles[i]

        @lru_cache(maxsize=None)
        # returns the maximum stones the current player can get
        # starting from piles at nextIndex with limit M
        def dp(nextIndex, M):
           
            # if you can take all remaining piles in one then do it
            if nextIndex + 2 * M >= n:
                return remainingSum[nextIndex]

            bestCur = 0
            # try all valid X in [1, 2M]
            # the opponent will play best moves starting at nextIndex + X
            for X in range(1, 2 * M + 1):
                # stones that are left for the opponents best play
                opponentGets = dp(nextIndex + X, max(M, X))
                # current players total = all remaining - opponents best
                currentTotal = remainingSum[nextIndex] - opponentGets
                # update score if this move gives larger score
                if currentTotal > bestCur:
                    bestCur = currentTotal

            return bestCur

        # alice starts at index 0 with M = 1
        return dp(0, 1)



#explanation

# This game is modeled using the recursive Minimax function dp(i, M) 
# that gives the maximum stones the current player can collect starting 
# from index i when they can take up to 2M piles.
# For every possible number of piles X the player can take, you 
# figure out how many stones the opponent would get if they played perfectly next.
# The current player total is the stones left minus whatever the opponent can win.
# The minimax function tries all choices of X and picks the one that gives the most stones.
# The @lru_cache makes sure we donâ€™t redo the same work multiple times.

